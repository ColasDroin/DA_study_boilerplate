mylhcbeam = 1;
option, -echo,warn, -info;
call, file="acc-models-lhc/runII/2018/toolkit/macro.madx";

    crossing_save: macro = {
    on_x1_aux=on_x1;on_sep1_aux=on_sep1;on_a1_aux=on_a1;on_o1_aux=on_o1;
    on_x2_aux=on_x2;on_sep2_aux=on_sep2;on_a2_aux=on_a2;on_o2_aux=on_o2; on_oe2_aux=on_oe2;
    on_x5_aux=on_x5;on_sep5_aux=on_sep5;on_a5_aux=on_a5;on_o5_aux=on_o5;
    on_x8_aux=on_x8;on_sep8_aux=on_sep8;on_a8_aux=on_a8;on_o8_aux=on_o8;
    on_disp_aux=on_disp;
    on_alice_aux=on_alice;
    on_lhcb_aux=on_lhcb;
    on_ov2_aux=on_ov2;
    on_ov5_aux=on_ov5;
    };

    crossing_disable: macro={
    on_x1=0;on_sep1=0;on_a1=0;on_o1=0;
    on_x2=0;on_sep2=0;on_a2=0;on_o2=0;on_oe2=0;
    on_x5=0;on_sep5=0;on_a5=0;on_o5=0;
    on_x8=0;on_sep8=0;on_a8=0;on_o8=0;
    on_disp=0;
    on_alice_normalized=0; on_lhcb_normalized=0;
    on_ov2=0;on_ov5=0;
    };

    crossing_restore: macro={
    on_x1=on_x1_aux;on_sep1=on_sep1_aux;on_a1=on_a1_aux;on_o1=on_o1_aux;
    on_x2=on_x2_aux;on_sep2=on_sep2_aux;on_a2=on_a2_aux;on_o2=on_o2_aux; on_oe2=on_oe2_aux;
    on_x5=on_x5_aux;on_sep5=on_sep5_aux;on_a5=on_a5_aux;on_o5=on_o5_aux;
    on_x8=on_x8_aux;on_sep8=on_sep8_aux;on_a8=on_a8_aux;on_o8=on_o8_aux;
    on_disp=on_disp_aux;
    on_alice=on_alice_aux; on_lhcb=on_lhcb_aux;
    on_ov2=on_ov2_aux;
    on_ov5=on_ov5_aux;
    };
    ;
call, file="acc-models-lhc/runII/2018/lhc_as-built.seq";
call, file="acc-models-lhc/runIII/RunIII_dev/IR7-Run3seqedit.madx";
slicefactor=8;
call, file="acc-models-lhc/runII/2018/toolkit/myslice.madx";
nrj = 557600;
bv_aux = 1;

    beam, particle=ion,sequence=lhcb1,
        energy=557600,
        sigt=0.0001,
        bv=1,
        npart=1,
        sige=1e-06,
        ex=3.4735881079626975e-10,
        ey=3.4735881079626975e-10,
        mass=193.6872729,
        charge=82;
    ;
use, sequence=lhcb1;
nrj = 6800.0;
nrj = 557600;

    beam, particle=ion,sequence=lhcb2,
        energy=557600,
        sigt=0.0001,
        bv=-1,
        npart=1,
        sige=1e-06,
        ex=3.4735881079626975e-10,
        ey=3.4735881079626975e-10,
        mass=193.6872729,
        charge=82;
    ;
use, sequence=lhcb2;
nrj = 6800.0;
use, sequence=lhcb1; makethin,sequence=lhcb1, style=teapot, makedipedge=true;
use, sequence=lhcb2; makethin,sequence=lhcb2, style=teapot, makedipedge=true;
seqedit, sequence=lhcb1; flatten;cycle, start=IP3; flatten; endedit;
seqedit, sequence=lhcb2; flatten;cycle, start=IP3; flatten; endedit;
call, file="acc-models-lhc/runIII/RunIII_dev/ION_2024/opticsfile.21";
call, file="ir7_strengths.madx";
on_alice := on_alice_normalized * 7000.  / nrj;
on_lhcb := on_lhcb_normalized * 7000. / nrj;
use, sequence=lhcb1;
twiss;
exec, crossing_save;
exec, crossing_disable;
twiss;
exec, crossing_restore;
use, sequence=lhcb2;
twiss;
exec, crossing_save;
exec, crossing_disable;
twiss;
exec, crossing_restore;
exec, crossing_save;
exec, crossing_disable;
twiss;
exec, crossing_restore;
nrj = 557600;

    beam, particle=ion,sequence=lhcb1,
        energy=557600,
        sigt=0.0001,
        bv=1,
        npart=1,
        sige=1e-06,
        ex=3.4735881079626975e-10,
        ey=3.4735881079626975e-10,
        mass=193.6872729,
        charge=82;
    ;
use, sequence=lhcb1;
nrj = 6800.0;
use, sequence=lhcb1;
twiss;
nrj = 557600;

    beam, particle=ion,sequence=lhcb2,
        energy=557600,
        sigt=0.0001,
        bv=-1,
        npart=1,
        sige=1e-06,
        ex=3.4735881079626975e-10,
        ey=3.4735881079626975e-10,
        mass=193.6872729,
        charge=82;
    ;
use, sequence=lhcb2;
nrj = 6800.0;
use, sequence=lhcb2;
twiss;
